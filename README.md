# Interactive Reaction-Diffusion Models

## The Theory of Reaction-Diffusion Equations
Complex and beautiful patterns, including ones very similar to those appearing on many animals in nature, can be generated from a chemical model where two reactants are simultaneously reacting with each other and diffusing through the system. In the most common of these models, known as the <b>Grey-Scott Model</b>, the reaction scheme is 

<img src="https://render.githubusercontent.com/render/math?math=U %2B 2V \rightarrow V">
<img src="https://render.githubusercontent.com/render/math?math=V \rightarrow P,">

i.e. one molecule of reactant U and two of reactant V react to create three molecules of reactant V, and occasionally molecules of reactant V convert to the inert product P. This first reaction 'feeds' reactant U into the system, and the second reaction 'kills' molecules of reactant V, removing them from the system. The rate constants <i>f</i> and <i>k</i>, respectively, set the speed of each of these reactions.

When both reactants diffuse through the system, with diffusion rates <img src="https://render.githubusercontent.com/render/math?math=r_u"> and <img src="https://render.githubusercontent.com/render/math?math=r_v">, respectively, the concentrations <i>u</i> and <i>v</i> of each reactant change with time as

<img src="https://render.githubusercontent.com/render/math?math=\frac{\partial u}{\partial t} = r_u \nabla^2 u - uv^2 %2B f(1-u)">
<img src="https://render.githubusercontent.com/render/math?math=\frac{\partial v}{\partial t} = r_v \nabla^2 v %2B uv^2 - (f%2Bk)v.">

These partial differential equations can be solved numerically to simulate chemical systems. Varying the four rate constants &mdash; <img src="https://render.githubusercontent.com/render/math?math=r_u">, <img src="https://render.githubusercontent.com/render/math?math=r_v">, <i>f</i>, and <i>k</i> &mdash; changes the pattern generated by the system.


## Our PDE Solver
Our numerical implementation of the reaction-diffusion model can be found in the <b>evolve()</b> function in the <b>pde_solver.py</b> python script. The user can vary many components of the model, including the boundary conditions, the spatial dimensions, the length of time over which it integrates, and the discrete Laplacian kernel used to perform the spatial derivation. 

## Matplotlib Visualization
We include a premade visualization of the PDE solution using the Matplotlib.pyplot library in the <b>Basic_Plotting()</b> function in the <b>BasicPlotting.py</b> python script. The output has been specifically designed for streamlined production of figures for scientific presentation. This function directly interfaces with our PDE solver so that parameters can be set locally before figure generation. The following are examples of the output files:

![gif load failed](/groovy/vis/diffusionReactionSimulation_Example.gif "Example Mitosis animation")

This is a Grey-Scott simulation with <i>f</i> = 0.0367, <i>k</i> = 0.0649 and fixed boundary conditions.

![gif load failed](/groovy/vis/diffusionReactionSimulation_Example2.gif "Example Pattern animation")

This is a Grey-Scott simulation with <i>f</i> = 0.055, <i>k</i> = 0.062 and fixed boundary conditions.

![gif load failed](/groovy/vis/diffusionReactionSimulation_Example2_Periodic.gif "Example Pattern animation with PBC")

This is a simulation with the same parameters as above, but periodic boundary conditions imposed.

## Pygame Visualization
We can continue to extend how we utilize these simulation and visualization techniques by creating a more interactive environment. The user can not only define their own parameters in terminal but can also draw different initial conditions by setting certain regions of the environment to have reactant U (red) and reactant V (blue). This way the user has a more involved method of manipulating initial conditions to observe how the PDE's evolve over time.

<p align="center">
  <img src="/groovy/vis/ex_canvas.jpg" width="400" height="400">
</p>
At the start, the program asks the user if they want to input their own boundary conditions. So the user uses the Left-Click to add reactant U and Right-Click to add reactant V.

These next images show the simulation of the diffusion-reaction with initial conditions  (without user input boundary conditions). <i>ru</i> = 1.0, <i>rv</i> = 0.5, <i>f</i> = 0.055, <i>k</i> = 0.062.

<p align="center">
  <img src="/groovy/vis/ru_1_rv_005_f_0055_k_0062_beginning.jpg" width="400" height="400">
</p>
This is the early stages of the evolution.

<p align="center">
  <img src="/groovy/vis/ru_1_rv_005_f_0055_k_0062_mid.jpg" width="400" height="400">
</p>
This is mid-way into the simulation.

<p align="center">
  <img src="/groovy/vis/ru_1_rv_005_f_0055_k_0062_final.jpg" width="400" height="400">
</p>
This is the final image when all of the time steps have occurred.

## Machine Learning
Once a steady state is reached for a Diffusion-Reaction simulation, the pattern that is formed is characteristic of the diffisuion and reaction parameters that were set for the evolution. Therefore, we can use a Convolutional Neural Network (CNN) to study the relevant structures in the images and solve the backwards problem, receiving final steady state images as inputs and predicting the system parameters.

It was first necessary to create a large database of 18,000 steady state systems.
<p align="center">
  <img src="/groovy/ml/figs/dataset.png" width="800" height="800">
</p>

Once this was done, it was possible to train the CNN. The training curves are shown below, where Early Stopping was implemented to avoid overfitting.
<p align="center">
  <img src="/groovy/ml/figs/training.png" width="500" height="400">
</p>

This model allows us to determine evolution parameters from steady states. To evaluate this qualitatively, we can take the CNN predictions and pump them back through the PDE solver, and visualize the difference between the steady state from the real parameters, and the steady state from the predicted parameters. Here are two examples from the test set.

![gif load failed](/groovy/ml/figs/test_1.gif "Example 1 from test set")

![gif load failed](/groovy/ml/figs/test_2.gif "Example 2 from test set")

